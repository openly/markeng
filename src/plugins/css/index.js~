// Generated by CoffeeScript 1.7.1
var ElementsList, EventManager, FSManager, config, getAllCSS, _;

ElementsList = require('../../lib/elements_list');

EventManager = require('../../lib/event_manager');

FSManager = require('../../lib/fs_manager');

config = require('../../config');

_ = require('underscore');

getAllCSS = function(args, cb) {
  if (args.css instanceof String) {
    args.css = [args.css];
  }
  if (!(args.css instanceof Array)) {
    args.css = [];
  }
  if (!(config.externalCSS instanceof Array)) {
    config.externalCSS = [];
  }
  args.css = _.union(config.externalCSS, args.css);
  args.css = _.union(args.css, _.map(FSManager.getDirContents('css', [/\.css$/]), function(css) {
    return "/static/css/" + css;
  }));
  _.each(ElementsList.getPages(), function(page) {
    return args.css = _.union(args.css, _.map(FSManager.getDirContents("" + page.elementDir + "/css", [/\.css$/]), function(css) {
      return "/static" + page.elementDir + "/css/" + css;
    }));
  });
  _.each(ElementsList.getComps(), function(comp) {
    return args.css = _.union(args.css, _.map(FSManager.getDirContents("" + comp.elementDir + "/css", [/\.css$/]), function(css) {
      return "/static" + comp.elementDir + "/css/" + css;
    }));
  });
  return cb(null, args);
};

EventManager.on('page', 'get_css', getAllCSS);

EventManager.on('comp', 'get_css', getAllCSS);
