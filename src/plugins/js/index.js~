// Generated by CoffeeScript 1.7.1
var ElementsList, EventManager, FSManager, config, getAllJS, _;

ElementsList = require('../../lib/elements_list');

EventManager = require('../../lib/event_manager');

FSManager = require('../../lib/fs_manager');

config = require('../../config');

_ = require('underscore');

getAllJS = function(args, cb) {
  if (args.js instanceof String) {
    args.js = [args.js];
  }
  if (!(args.js instanceof Array)) {
    args.js = [];
  }
  if (!(config.externalJS instanceof Array)) {
    config.externalJS = [];
  }
  args.js = _.union(config.externalJS, args.js);
  args.js = _.union(args.js, _.map(FSManager.getDirContents('js', [/\.js$/]), function(js) {
    return "/static/js/" + js;
  }));
  _.each(ElementsList.getPages(), function(page) {
    return args.js = _.union(args.js, _.map(FSManager.getDirContents("" + page.elementDir + "/js", [/\.js$/]), function(js) {
      return "/static" + page.elementDir + "/js/" + js;
    }));
  });
  _.each(ElementsList.getComps(), function(comp) {
    return args.js = _.union(args.js, _.map(FSManager.getDirContents("" + comp.elementDir + "/js", [/\.js$/]), function(js) {
      return "/static" + comp.elementDir + "/js/" + js;
    }));
  });
  return cb(null, args);
};

EventManager.on('page', 'get_js', getAllJS);

EventManager.on('comp', 'get_js', getAllJS);
