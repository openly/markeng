// Generated by CoffeeScript 1.6.3
var FSManager, MarkupBuilder, md5, pageBuilder, path, resourceBuilder;

path = require('path');

FSManager = require('../../fs_manager');

resourceBuilder = require('./resource');

pageBuilder = require('./page');

md5 = require('MD5');

MarkupBuilder = (function() {
  function MarkupBuilder() {
    this.buildStaticVersion = md5((new Date()).toISOString());
  }

  MarkupBuilder.prototype.build = function(opDir) {
    var assets;
    this.createBuildDir(opDir);
    assets = this.buildAssets();
    return this.buildPages(assets);
  };

  MarkupBuilder.prototype.createBuildDir = function(opDir) {
    FSManager.rmrf(opDir, '/static/');
    FSManager.createRecursiveDirs(opDir, '/static/');
    return this.buildDir = path.normalize(opDir + '/static/');
  };

  MarkupBuilder.prototype.buildAssets = function() {
    return resourceBuilder.build(this.buildDir, this.buildStaticVersion);
  };

  MarkupBuilder.prototype.buildPages = function(assets) {
    return pageBuilder.build(assets, this.buildDir);
  };

  return MarkupBuilder;

})();

module.exports = MarkupBuilder;
